name: Check Theorem

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code with full history
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Find secret in git history
        id: find_secret
        run: |
          echo "üîç –ò—â–µ–º —Å–µ–∫—Ä–µ—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∏—Å—Ç–æ—Ä–∏–∏ –∫–æ–º–º–∏—Ç–æ–≤..."
          SECRET_INFO=$(git log --all --grep="4T_S_P" --oneline -1 | cut -d' ' -f2-)
          if [ -n "$SECRET_INFO" ]; then
            echo "‚úÖ –ù–∞–π–¥–µ–Ω–æ: $SECRET_INFO"
            echo "secret_info=$SECRET_INFO" >> $GITHUB_OUTPUT
          else
            echo "‚ùå –°–µ–∫—Ä–µ—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
            echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏—Å—Ç–æ—Ä–∏—é –∫–æ–º–º–∏—Ç–æ–≤: git log --oneline"
            exit 1
          fi

      - name: Extract pastebin ID
        id: extract_id
        run: |
          SECRET_INFO="${{ steps.find_secret.outputs.secret_info }}"
          # –ò—â–µ–º –ø–æ–ª–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω 4T_S_P_xxxxxxx –∏ –∏–∑–≤–ª–µ–∫–∞–µ–º —Ç–æ–ª—å–∫–æ ID —á–∞—Å—Ç—å
          PASTEBIN_ID=$(echo "$SECRET_INFO" | grep -o '4T_S_P_[A-Za-z0-9]*' | sed 's/4T_S_P_//')
          if [ -n "$PASTEBIN_ID" ]; then
            echo "‚úÖ Pastebin ID: $PASTEBIN_ID"
            echo "pastebin_id=$PASTEBIN_ID" >> $GITHUB_OUTPUT
          else
            echo "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–∑–≤–ª–µ—á—å Pastebin ID"
            echo "–ü–æ–ª—É—á–µ–Ω–Ω–∞—è —Å–µ–∫—Ä–µ—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: $SECRET_INFO"
            exit 1
          fi

      - name: Test theorem implementation
        id: test_theorem
        run: |
          echo "üßÆ –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Ç–µ–æ—Ä–µ–º—ã ..."
          if ! python test_theorem.py; then
            echo "‚ùå –¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ–π–¥–µ–Ω—ã"
            exit 1
          fi
          echo "‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã"

      - name: Reveal final message
        if: success()
        run: |
          echo "üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –∏—Å–ø—Ä–∞–≤–∏–ª–∏ —Ç–µ–æ—Ä–µ–º—É!"
          echo "üìù –†–∞–∑–≥–∞–¥–∞–π—Ç–µ –∑–∞–≥–∞–¥–∫—É –ø–æ —Å—Å—ã–ª–∫–µ:"
          echo ""
          echo "üîó –°—Å—ã–ª–∫–∞ –Ω–∞ Pastebin —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π:"
          echo "https://pastebin.com/raw/${{ steps.extract_id.outputs.pastebin_id }}"